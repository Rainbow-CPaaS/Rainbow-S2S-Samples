#!/usr/bin/env node

"use strict";
const path = require('path');
var fs = require('fs-extra');

var userPath = process.env.INIT_CWD;

var createDirectory = (destdirectory) => {
    console.log(`creating ${destdirectory}...`);
    try {
        if (!fs.existsSync(destdirectory)) {
            console.log('createDirectory', `creatig directory ${destdirectory} ...`);
            fs.mkdirSync(destdirectory);
	    return true;
        }
    } catch (e) {
        console.error('' + e);
    }
    return false;
};

var copyFile = (src, dest) => {
        if(!fs.existsSync(dest)){
                fs.copySync(path.resolve(src),dest);
        }
}

var copyDirectory = (src, dest) => {
    let created = createDirectory(dest);
    // copy only if directory is newly created to avoid file overwritting
    if(created){
     fs.copy(src, dest, function(err) {
        if (err) {
            console.log('An error occured while copying the folder.')
            return console.error(err)
        }
        console.log('Copy completed!');
      });
    }
};

var dir2copyParams = [
    { src: `${__dirname}${path.sep}..${path.sep}config`, dest: `${userPath}${path.sep}config` }
];

var files2copyParams = [
    { src: `${__dirname}${path.sep}..${path.sep}non-nodejs-bot-loader${path.sep}config${path.sep}bot-loader-params.json`, dest: `${userPath}${path.sep}config${path.sep}bot-loader-params.json` },
    { src: `${__dirname}${path.sep}..${path.sep}non-nodejs-bot-loader${path.sep}s2s-zmq-bot-loader.js.sample`, dest: `${userPath}${path.sep}s2s-zmq-bot-loader.js.sample` }
];

for (var idx in dir2copyParams) {
    copyDirectory(dir2copyParams[idx].src, dir2copyParams[idx].dest);
}
for (var idx in files2copyParams) {
    copyFile(files2copyParams[idx].src, files2copyParams[idx].dest);
}
